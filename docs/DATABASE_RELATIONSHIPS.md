# üóÑÔ∏è Database Schema ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå - IoT Electric Energy Management System

## üìã ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

‡∏£‡∏∞‡∏ö‡∏ö IoT Electric Energy Management ‡πÉ‡∏ä‡πâ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• **PostgreSQL 15** ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ **14 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å**, **6 Views**, **13 Functions** ‡πÅ‡∏•‡∏∞ **‡∏´‡∏•‡∏≤‡∏¢ Triggers** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå IoT ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô

---

## üèóÔ∏è ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å (Core Tables)

### üë• ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (User & Approval Management)

#### 1. `users` - ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,        -- ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö login
    password_hash VARCHAR(255) NOT NULL,       -- ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏•‡πâ‡∏ß
    first_name VARCHAR(100),                   -- ‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á  
    last_name VARCHAR(100),                    -- ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•
    role VARCHAR(50) DEFAULT 'user',           -- ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (user, admin)
    is_active BOOLEAN DEFAULT true,            -- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
    last_login TIMESTAMP,                      -- ‡πÄ‡∏ß‡∏•‡∏≤ login ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);
```

#### 2. `device_approval_status` - ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
```sql
CREATE TABLE device_approval_status (
    id SERIAL PRIMARY KEY,
    status_code VARCHAR(20) UNIQUE NOT NULL,   -- ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (pending, approved, rejected)
    status_name VARCHAR(100) NOT NULL,         -- ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
    status_description TEXT,                   -- ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
    is_active BOOLEAN DEFAULT true,
    sort_order INTEGER DEFAULT 0,
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);
```

#### 3. `device_approval_history` - ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
```sql
CREATE TABLE device_approval_history (
    id SERIAL PRIMARY KEY,
    device_id VARCHAR(100) NOT NULL,
    action VARCHAR(50) NOT NULL,               -- ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥ (approved, rejected, etc.)
    previous_status_id INTEGER,
    new_status_id INTEGER,
    performed_by_name VARCHAR(255),            -- ‡∏ú‡∏π‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
    performed_by_email VARCHAR(255),
    action_reason TEXT,                        -- ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
    action_data JSONB,                         -- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);
```

### üè¢ ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á (Organization & Location)

#### 4. `faculties` - ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏ì‡∏∞‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
```sql
CREATE TABLE faculties (
    id SERIAL PRIMARY KEY,
    faculty_code VARCHAR(30) UNIQUE NOT NULL,  -- ‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏ì‡∏∞
    faculty_name VARCHAR(255) NOT NULL,        -- ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ì‡∏∞
    contact_email VARCHAR(255),                -- ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠
    contact_phone VARCHAR(50),                 -- ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);
```

#### 5. `locations` - ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
```sql
CREATE TABLE locations (
    id SERIAL PRIMARY KEY,
    faculty_id INTEGER NOT NULL REFERENCES faculties(id),
    building VARCHAR(100) NOT NULL,            -- ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£
    floor VARCHAR(50),                         -- ‡∏ä‡∏±‡πâ‡∏ô
    room VARCHAR(50),                          -- ‡∏´‡πâ‡∏≠‡∏á
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(faculty_id, building, floor, room)
);
```

#### 6. `responsible_persons` - ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
```sql
CREATE TABLE responsible_persons (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,                -- ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö
    email VARCHAR(255) UNIQUE NOT NULL,        -- ‡∏≠‡∏µ‡πÄ‡∏°‡∏• (unique identifier)
    phone VARCHAR(20),                         -- ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå
    department VARCHAR(100),                   -- ‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
    position VARCHAR(100),                     -- ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
    faculty_id INTEGER REFERENCES faculties(id), -- ‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏ì‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î
    is_active BOOLEAN DEFAULT true,            -- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);
```

### üè≠ ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï (Equipment & Manufacturer)

#### 7. `manufacturers` - ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
```sql
CREATE TABLE manufacturers (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) UNIQUE NOT NULL,         -- ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï
    country VARCHAR(50),                       -- ‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);
```

#### 8. `device_models` - ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏∏‡πà‡∏ô‡πÅ‡∏•‡∏∞‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå IoT
```sql
CREATE TABLE device_models (
    id SERIAL PRIMARY KEY,
    model_name VARCHAR(255) NOT NULL,          -- ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∏‡πà‡∏ô
    manufacturer_id INTEGER NOT NULL REFERENCES manufacturers(id),
    supported_connections connection_type_enum[], -- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(model_name, manufacturer_id)
);
```

#### 9. `power_specifications` - ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡πÄ‡∏õ‡∏Ñ‡∏î‡πâ‡∏≤‡∏ô‡πÑ‡∏ü‡∏ü‡πâ‡∏≤
```sql
CREATE TABLE power_specifications (
    id SERIAL PRIMARY KEY,
    rated_voltage NUMERIC(8,2) NOT NULL,       -- ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
    rated_current NUMERIC(8,2) NOT NULL,       -- ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
    rated_power NUMERIC(10,2) NOT NULL,        -- ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
    power_phase power_phase_enum NOT NULL DEFAULT 'single', -- ‡πÄ‡∏ü‡∏™‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ (single/three)
    frequency NUMERIC(5,2) DEFAULT 50.0,       -- ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà (Hz)
    accuracy VARCHAR(10),                       -- ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(rated_voltage, rated_current, rated_power, power_phase)
);
```

#### 10. `meter_prop` - ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏î‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô
```sql
CREATE TABLE meter_prop (
    meter_id SERIAL PRIMARY KEY,
    model_name VARCHAR(255) NOT NULL,          -- ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∏‡πà‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏î
    manufacturer_id INTEGER NOT NULL REFERENCES manufacturers(id),
    power_spec_id INTEGER NOT NULL REFERENCES power_specifications(id),
    meter_type meter_type_enum NOT NULL DEFAULT 'digital', -- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏î
    manufacture_date DATE,                     -- ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(model_name, manufacturer_id)
);
```

### üì± ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå IoT (IoT Device Management)

#### 11. `devices_prop` - ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå IoT ‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß
```sql
CREATE TABLE devices_prop (
    id SERIAL PRIMARY KEY,
    device_id VARCHAR(100) UNIQUE NOT NULL,    -- ‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
    device_name VARCHAR(255) NOT NULL,         -- ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
    device_model_id INTEGER REFERENCES device_models(id),
    meter_id INTEGER UNIQUE REFERENCES meter_prop(meter_id),
    location_id INTEGER REFERENCES locations(id),
    responsible_person_id INTEGER REFERENCES responsible_persons(id),
    install_date DATE,                         -- ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á
    ip_address INET,                          -- IP Address
    mac_address MACADDR,                      -- MAC Address
    connection_type connection_type_enum DEFAULT 'wifi',
    data_collection_interval INTEGER DEFAULT 60, -- ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
    device_type VARCHAR(100),                 -- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
    firmware_version VARCHAR(50),             -- ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡πà‡∏ô firmware
    status device_status_enum DEFAULT 'active' NOT NULL, -- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
    is_enabled BOOLEAN DEFAULT true,          -- ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
    approval_status_id INTEGER DEFAULT 2 REFERENCES device_approval_status(id),
    mqtt_data JSONB,                         -- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• MQTT
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);
```

#### 12. `devices_pending` - ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
```sql
CREATE TABLE devices_pending (
    id SERIAL PRIMARY KEY,
    device_id VARCHAR(100) UNIQUE NOT NULL,    -- ‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
    device_name VARCHAR(255),                  -- ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
    approval_status_id INTEGER DEFAULT 1 NOT NULL REFERENCES device_approval_status(id),
    device_type VARCHAR(100),                  -- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
    firmware_version VARCHAR(50),              -- ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡πà‡∏ô firmware
    mac_address MACADDR,                       -- MAC Address
    ip_address INET,                          -- IP Address
    connection_type connection_type_enum DEFAULT 'wifi',
    mqtt_data JSONB NOT NULL,                 -- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• MQTT
    discovered_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP, -- ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏û‡∏ö
    last_seen_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,  -- ‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    discovery_source VARCHAR(50) DEFAULT 'mqtt', -- ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≤
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);
```

#### 13. `devices_rejected` - ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
```sql
CREATE TABLE devices_rejected (
    id SERIAL PRIMARY KEY,
    device_id VARCHAR(100) UNIQUE NOT NULL,    -- ‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
    device_name VARCHAR(255),                  -- ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
    device_type VARCHAR(100),                  -- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
    firmware_version VARCHAR(50),              -- ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡πà‡∏ô firmware
    mac_address MACADDR,                       -- MAC Address
    ip_address INET,                          -- IP Address
    connection_type connection_type_enum,
    approval_status_id INTEGER DEFAULT 3 NOT NULL REFERENCES device_approval_status(id),
    original_mqtt_data JSONB,                 -- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• MQTT ‡πÄ‡∏î‡∏¥‡∏°
    rejected_by_name VARCHAR(255),            -- ‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
    rejected_by_email VARCHAR(255),           -- ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
    rejection_date TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    rejection_reason TEXT,                    -- ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
    original_discovered_at TIMESTAMPTZ,       -- ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏û‡∏ö‡πÄ‡∏î‡∏¥‡∏°
    can_resubmit BOOLEAN DEFAULT true,        -- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    resubmit_after TIMESTAMPTZ,              -- ‡∏™‡πà‡∏á‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å
    resubmission_count INTEGER DEFAULT 0,     -- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÉ‡∏´‡∏°‡πà
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);
```

### üìä ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ (Operation & History Data)

#### 14. `devices_data` - ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Real-time ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå IoT
```sql
CREATE TABLE devices_data (
    id SERIAL PRIMARY KEY,
    device_id VARCHAR(100) NOT NULL REFERENCES devices_prop(device_id),
    
    -- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢
    network_status network_status_enum DEFAULT 'offline',
    connection_quality INTEGER DEFAULT 0,     -- ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì (0-100)
    signal_strength INTEGER,                   -- ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì (-120 ‡∏ñ‡∏∂‡∏á 0 dBm)
    
    -- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÄ‡∏ü‡∏™‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
    voltage NUMERIC(8,2),                      -- ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ (V)
    current_amperage NUMERIC(8,2),             -- ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ (A)
    power_factor NUMERIC(4,3),                 -- ‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á
    frequency NUMERIC(5,2),                    -- ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà (Hz)
    
    -- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏™‡∏≤‡∏°‡πÄ‡∏ü‡∏™
    voltage_phase_b NUMERIC(8,2),              -- ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÄ‡∏ü‡∏™ B
    voltage_phase_c NUMERIC(8,2),              -- ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÄ‡∏ü‡∏™ C
    current_phase_b NUMERIC(8,2),              -- ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏ü‡∏™ B
    current_phase_c NUMERIC(8,2),              -- ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏ü‡∏™ C
    power_factor_phase_b NUMERIC(4,3),         -- ‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ü‡∏™ B
    power_factor_phase_c NUMERIC(4,3),         -- ‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ü‡∏™ C
    
    -- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô
    active_power NUMERIC(12,2),                -- ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏à‡∏£‡∏¥‡∏á (W)
    reactive_power NUMERIC(12,2),              -- ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÄ‡∏™‡∏°‡∏∑‡∏≠‡∏ô (VAR)
    apparent_power NUMERIC(12,2),              -- ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏õ‡∏£‡∏≤‡∏Å‡∏è (VA)
    active_power_phase_a NUMERIC(12,2),        -- ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏ü‡∏™ A
    active_power_phase_b NUMERIC(12,2),        -- ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏ü‡∏™ B
    active_power_phase_c NUMERIC(12,2),        -- ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏ü‡∏™ C
    
    -- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ
    device_temperature NUMERIC(5,2),           -- ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (¬∞C)
    total_energy NUMERIC(15,3) DEFAULT 0,      -- ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏£‡∏ß‡∏° (kWh)
    daily_energy NUMERIC(10,3) DEFAULT 0,      -- ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (kWh)
    uptime_hours BIGINT DEFAULT 0,             -- ‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)
    
    -- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
    last_maintenance TIMESTAMPTZ,              -- ‡∏Å‡∏≤‡∏£‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    last_data_received TIMESTAMPTZ,            -- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö
    data_collection_count BIGINT DEFAULT 0,    -- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    last_error_code VARCHAR(50),               -- ‡∏£‡∏´‡∏±‡∏™ error ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    last_error_message TEXT,                   -- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° error ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    last_error_time TIMESTAMPTZ,               -- ‡πÄ‡∏ß‡∏•‡∏≤ error ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    error_count_today INTEGER DEFAULT 0,       -- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô error ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
    
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);
```

#### 15. `devices_history` - ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏ö‡∏ö Time-series
```sql
CREATE TABLE devices_history (
    id SERIAL PRIMARY KEY,
    device_id VARCHAR(100) NOT NULL REFERENCES devices_prop(device_id),
    recorded_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP NOT NULL,
    
    -- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
    voltage NUMERIC(8,2),
    current_amperage NUMERIC(8,2),
    power_factor NUMERIC(4,3),
    frequency NUMERIC(5,2),
    
    -- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏°‡πÄ‡∏ü‡∏™
    voltage_phase_b NUMERIC(8,2),
    voltage_phase_c NUMERIC(8,2),
    current_phase_b NUMERIC(8,2),
    current_phase_c NUMERIC(8,2),
    power_factor_phase_b NUMERIC(4,3),
    power_factor_phase_c NUMERIC(4,3),
    
    -- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô
    active_power NUMERIC(12,2),
    reactive_power NUMERIC(12,2),
    apparent_power NUMERIC(12,2),
    active_power_phase_a NUMERIC(12,2),
    active_power_phase_b NUMERIC(12,2),
    active_power_phase_c NUMERIC(12,2),
    
    -- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏£‡∏ß‡∏°
    total_energy NUMERIC(15,3) DEFAULT 0,
    daily_energy NUMERIC(10,3) DEFAULT 0,
    total_energy_import NUMERIC(15,3) DEFAULT 0, -- ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤
    total_energy_export NUMERIC(15,3) DEFAULT 0, -- ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å
    
    device_temperature NUMERIC(5,2),
    connection_quality INTEGER DEFAULT 0,
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);
```

---

## üîó ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á (Table Relationships)

### üìä Entity Relationship Diagram (ERD)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   faculties     ‚îÇ    ‚îÇ manufacturers   ‚îÇ    ‚îÇdevice_approval_ ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ    ‚îÇ     status      ‚îÇ
‚îÇ ‚Ä¢ id (PK)       ‚îÇ    ‚îÇ ‚Ä¢ id (PK)       ‚îÇ    ‚îÇ ‚Ä¢ id (PK)       ‚îÇ
‚îÇ ‚Ä¢ faculty_code  ‚îÇ    ‚îÇ ‚Ä¢ name          ‚îÇ    ‚îÇ ‚Ä¢ status_code   ‚îÇ
‚îÇ ‚Ä¢ faculty_name  ‚îÇ    ‚îÇ ‚Ä¢ country       ‚îÇ    ‚îÇ ‚Ä¢ status_name   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ                      ‚îÇ                      ‚îÇ
          ‚îÇ 1:N                  ‚îÇ 1:N                  ‚îÇ 1:N
          ‚îÇ                      ‚îÇ                      ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   locations     ‚îÇ    ‚îÇ device_models   ‚îÇ    ‚îÇdevices_pending  ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ
‚îÇ ‚Ä¢ id (PK)       ‚îÇ    ‚îÇ ‚Ä¢ id (PK)       ‚îÇ    ‚îÇ ‚Ä¢ id (PK)       ‚îÇ
‚îÇ ‚Ä¢ faculty_id    ‚îÇ    ‚îÇ ‚Ä¢ model_name    ‚îÇ    ‚îÇ ‚Ä¢ device_id     ‚îÇ
‚îÇ ‚Ä¢ building      ‚îÇ    ‚îÇ ‚Ä¢ manufacturer  ‚îÇ    ‚îÇ ‚Ä¢ approval_sta  ‚îÇ
‚îÇ ‚Ä¢ floor         ‚îÇ    ‚îÇ   _id (FK)      ‚îÇ    ‚îÇ   tus_id (FK)   ‚îÇ
‚îÇ ‚Ä¢ room          ‚îÇ    ‚îÇ ‚Ä¢ supported_con ‚îÇ    ‚îÇ ‚Ä¢ device_name   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ   nections      ‚îÇ    ‚îÇ ‚Ä¢ mqtt_data     ‚îÇ
          ‚îÇ            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ 1:N                  ‚îÇ 1:N
          ‚îÇ                      ‚îÇ
          ‚îÇ         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ         ‚îÇ                    ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇresponsible_     ‚îÇ ‚îÇ        ‚îÇ power_specifi   ‚îÇ
‚îÇ   persons       ‚îÇ ‚îÇ        ‚îÇ    cations      ‚îÇ
‚îÇ                 ‚îÇ ‚îÇ        ‚îÇ                 ‚îÇ
‚îÇ ‚Ä¢ id (PK)       ‚îÇ ‚îÇ        ‚îÇ ‚Ä¢ id (PK)       ‚îÇ
‚îÇ ‚Ä¢ name          ‚îÇ ‚îÇ        ‚îÇ ‚Ä¢ rated_voltage ‚îÇ
‚îÇ ‚Ä¢ email         ‚îÇ ‚îÇ        ‚îÇ ‚Ä¢ rated_current ‚îÇ
‚îÇ ‚Ä¢ faculty_id    ‚îÇ ‚îÇ        ‚îÇ ‚Ä¢ rated_power   ‚îÇ
‚îÇ   (FK)          ‚îÇ ‚îÇ        ‚îÇ ‚Ä¢ power_phase   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ         ‚îÇ                  ‚îÇ
          ‚îÇ 1:N     ‚îÇ                  ‚îÇ 1:N
          ‚îÇ         ‚îÇ                  ‚îÇ
          ‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ    ‚îÇ         ‚îÇ    ‚îÇ   meter_prop    ‚îÇ
          ‚îÇ    ‚îÇ         ‚îÇ    ‚îÇ                 ‚îÇ
          ‚îÇ    ‚îÇ         ‚îÇ    ‚îÇ ‚Ä¢ meter_id (PK) ‚îÇ
          ‚îÇ    ‚îÇ         ‚îÇ    ‚îÇ ‚Ä¢ model_name    ‚îÇ
          ‚îÇ    ‚îÇ         ‚îÇ    ‚îÇ ‚Ä¢ manufacturer  ‚îÇ
          ‚îÇ    ‚îÇ         ‚îÇ    ‚îÇ   _id (FK)      ‚îÇ
          ‚îÇ    ‚îÇ         ‚îÇ    ‚îÇ ‚Ä¢ power_spec    ‚îÇ
          ‚îÇ    ‚îÇ         ‚îÇ    ‚îÇ   _id (FK)      ‚îÇ
          ‚îÇ    ‚îÇ         ‚îÇ    ‚îÇ ‚Ä¢ meter_type    ‚îÇ
          ‚îÇ    ‚îÇ         ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ    ‚îÇ         ‚îÇ              ‚îÇ
          ‚îÇ    ‚îÇ         ‚îÇ              ‚îÇ 1:1
          ‚îÇ    ‚îÇ         ‚îÇ              ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              devices_prop               ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ ‚Ä¢ id (PK)                              ‚îÇ
‚îÇ ‚Ä¢ device_id (UK)                       ‚îÇ
‚îÇ ‚Ä¢ device_name                          ‚îÇ
‚îÇ ‚Ä¢ device_model_id (FK)                 ‚îÇ
‚îÇ ‚Ä¢ meter_id (FK)                        ‚îÇ
‚îÇ ‚Ä¢ location_id (FK)                     ‚îÇ
‚îÇ ‚Ä¢ responsible_person_id (FK)           ‚îÇ
‚îÇ ‚Ä¢ approval_status_id (FK)              ‚îÇ
‚îÇ ‚Ä¢ device_type, firmware_version        ‚îÇ
‚îÇ ‚Ä¢ status, is_enabled                   ‚îÇ
‚îÇ ‚Ä¢ mqtt_data                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ
          ‚îÇ 1:1
          ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  devices_data   ‚îÇ    ‚îÇ devices_history ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ
‚îÇ ‚Ä¢ id (PK)       ‚îÇ    ‚îÇ ‚Ä¢ id (PK)       ‚îÇ
‚îÇ ‚Ä¢ device_id     ‚îÇ    ‚îÇ ‚Ä¢ device_id     ‚îÇ
‚îÇ   (FK)          ‚îÇ    ‚îÇ   (FK)          ‚îÇ
‚îÇ ‚Ä¢ network_      ‚îÇ    ‚îÇ ‚Ä¢ recorded_at   ‚îÇ
‚îÇ   status        ‚îÇ    ‚îÇ ‚Ä¢ voltage       ‚îÇ
‚îÇ ‚Ä¢ voltage       ‚îÇ    ‚îÇ ‚Ä¢ current_      ‚îÇ
‚îÇ ‚Ä¢ current_      ‚îÇ    ‚îÇ   amperage      ‚îÇ
‚îÇ   amperage      ‚îÇ    ‚îÇ ‚Ä¢ active_power  ‚îÇ
‚îÇ ‚Ä¢ active_power  ‚îÇ    ‚îÇ ‚Ä¢ total_energy  ‚îÇ
‚îÇ ‚Ä¢ device_       ‚îÇ    ‚îÇ ‚Ä¢ device_       ‚îÇ
‚îÇ   temperature   ‚îÇ    ‚îÇ   temperature   ‚îÇ
‚îÇ ‚Ä¢ total_energy  ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ ‚Ä¢ last_data_    ‚îÇ
‚îÇ   received      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üîë Primary Keys ‡πÅ‡∏•‡∏∞ Foreign Keys

**Primary Keys (PK)**
- ‡∏ó‡∏∏‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏°‡∏µ `id` ‡πÄ‡∏õ‡πá‡∏ô SERIAL PRIMARY KEY
- `meter_prop` ‡πÉ‡∏ä‡πâ `meter_id` ‡πÄ‡∏õ‡πá‡∏ô PK ‡πÅ‡∏ó‡∏ô
- `devices_prop.device_id` ‡πÄ‡∏õ‡πá‡∏ô UNIQUE constraint

**Foreign Key Relationships**
```sql
-- Organizational Structure
locations.faculty_id ‚Üí faculties.id
responsible_persons.faculty_id ‚Üí faculties.id

-- Equipment Structure  
device_models.manufacturer_id ‚Üí manufacturers.id
meter_prop.manufacturer_id ‚Üí manufacturers.id
meter_prop.power_spec_id ‚Üí power_specifications.id

-- Device Management
devices_prop.device_model_id ‚Üí device_models.id
devices_prop.meter_id ‚Üí meter_prop.meter_id
devices_prop.location_id ‚Üí locations.id
devices_prop.responsible_person_id ‚Üí responsible_persons.id
devices_prop.approval_status_id ‚Üí device_approval_status.id

-- Device Data
devices_data.device_id ‚Üí devices_prop.device_id
devices_history.device_id ‚Üí devices_prop.device_id

-- Approval Process
devices_pending.approval_status_id ‚Üí device_approval_status.id
devices_rejected.approval_status_id ‚Üí device_approval_status.id
device_approval_history.previous_status_id ‚Üí device_approval_status.id
device_approval_history.new_status_id ‚Üí device_approval_status.id
```

---

## üìà Views ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (Important Views)

### 1. `devices_complete` - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô
```sql
-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏£‡∏ß‡∏°‡∏Ñ‡∏ì‡∏∞, ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£, ‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï, ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå
SELECT dp.device_id, dp.device_name, f.faculty_name, l.building, 
       dm.model_name, mfg.name AS manufacturer,
       dd.voltage, dd.active_power, dd.last_data_received
FROM devices_prop dp
JOIN locations l ON dp.location_id = l.id
JOIN faculties f ON l.faculty_id = f.id
JOIN device_models dm ON dp.device_model_id = dm.id
JOIN manufacturers mfg ON dm.manufacturer_id = mfg.id
LEFT JOIN devices_data dd ON dp.device_id = dd.device_id;
```

### 2. `devices_dashboard` - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Dashboard
```sql
-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ dashboard ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
SELECT device_id, device_name, faculty_name, building,
       device_manufacturer, meter_manufacturer,
       active_power, last_data_received,
       CASE 
           WHEN last_data_received > (now() - interval '5 minutes') THEN 'recent'
           WHEN last_data_received > (now() - interval '1 hour') THEN 'delayed' 
           ELSE 'stale'
       END AS data_freshness
FROM devices_complete;
```

### 3. `devices_monitoring` - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
```sql
-- ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà active ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏™‡∏π‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏ä‡πâ‡∏≤
SELECT device_id, device_name, faculty_name, building,
       device_temperature, last_data_received,
       CASE WHEN device_temperature > 70 THEN true ELSE false END AS temperature_high,
       CASE WHEN last_data_received < (now() - interval '10 minutes') THEN true ELSE false END AS data_stale
FROM devices_complete 
WHERE status = 'active' AND is_enabled = true;
```

### 4. `v_devices_with_caretakers` - ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•
```sql
-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö
SELECT dp.device_id, dp.device_name, l.building, f.faculty_name,
       rp.name AS caretaker_name, rp.email AS caretaker_email,
       dd.network_status, dd.active_power, dd.last_data_received
FROM devices_prop dp
JOIN locations l ON dp.location_id = l.id
JOIN faculties f ON l.faculty_id = f.id
LEFT JOIN responsible_persons rp ON dp.responsible_person_id = rp.id
LEFT JOIN devices_data dd ON dp.device_id = dd.device_id;
```

### 5. `devices_pending_complete` - ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô
```sql
-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
SELECT dp.device_id, dp.device_name, dp.device_type,
       das.status_name, dp.discovered_at, dp.last_seen_at,
       CASE 
           WHEN last_seen_at > (now() - interval '5 minutes') THEN 'online'
           WHEN last_seen_at > (now() - interval '1 hour') THEN 'recent'
           ELSE 'offline'
       END AS device_activity_status
FROM devices_pending dp
JOIN device_approval_status das ON dp.approval_status_id = das.id;
```

### 6. `devices_all_with_status` - ‡∏£‡∏ß‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
```sql
-- UNION ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á: pending, operational, rejected
SELECT 'pending' AS table_source, device_id, device_name, status_name
FROM devices_pending dp JOIN device_approval_status das ON dp.approval_status_id = das.id
UNION ALL
SELECT 'operational', device_id, device_name, status_name  
FROM devices_prop d JOIN device_approval_status das ON d.approval_status_id = das.id
UNION ALL
SELECT 'rejected', device_id, device_name, status_name
FROM devices_rejected dr JOIN device_approval_status das ON dr.approval_status_id = das.id;
```

---

## ‚öôÔ∏è Functions ‡πÅ‡∏•‡∏∞ Stored Procedures

### üîß Device Approval Functions

#### 1. `approve_device()` - ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
```sql
-- ‡∏¢‡πâ‡∏≤‡∏¢‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏à‡∏≤‡∏Å devices_pending ‡πÑ‡∏õ devices_prop
SELECT approve_device(
    'ESP32_ENGR_LAB_001',          -- device_id
    'Admin Name',                   -- approved_by_name  
    'admin@university.ac.th',      -- approved_by_email
    '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß',    -- approval_notes
    1,                             -- location_id
    1001,                          -- meter_id
    1,                             -- device_model_id
    1                              -- responsible_person_id
);
```

#### 2. `reject_device()` - ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
```sql
-- ‡∏¢‡πâ‡∏≤‡∏¢‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏à‡∏≤‡∏Å devices_pending ‡πÑ‡∏õ devices_rejected
SELECT reject_device(
    'ESP32_UNKNOWN_999',           -- device_id
    'Admin Name',                  -- rejected_by_name
    'admin@university.ac.th',      -- rejected_by_email
    '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢', -- rejection_reason
    true                          -- can_resubmit
);
```

### üë• Caretaker Management Functions

#### 3. `assign_device_caretaker()` - ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•
```sql
-- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
SELECT assign_device_caretaker(
    'ESP32_ENGR_LAB_001',          -- device_id
    5,                             -- responsible_person_id
    'Admin Name',                  -- assigned_by_name
    'admin@university.ac.th'       -- assigned_by_email
);
```

#### 4. `get_devices_by_caretaker()` - ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ï‡∏≤‡∏°‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•
```sql
-- ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•
SELECT * FROM get_devices_by_caretaker(5); -- responsible_person_id
```

#### 5. `get_caretaker_device_summary()` - ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•
```sql
-- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô
SELECT * FROM get_caretaker_device_summary(); -- ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô
SELECT * FROM get_caretaker_device_summary(5); -- ‡∏Ñ‡∏ô‡πÉ‡∏î‡∏Ñ‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á
```

### üìä Analytics Functions

#### 6. `calculate_energy_consumption()` - ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô
```sql
-- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
SELECT * FROM calculate_energy_consumption(
    'ESP32_ENGR_LAB_001',          -- device_id
    '2025-08-01'::DATE,            -- start_date
    '2025-08-31'::DATE             -- end_date
);
```

### üßπ Maintenance Functions

#### 7. `cleanup_old_history_data()` - ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
```sql
-- ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡∏ß‡πà‡∏≤ 365 ‡∏ß‡∏±‡∏ô (default)
SELECT cleanup_old_history_data();        -- 365 ‡∏ß‡∏±‡∏ô
SELECT cleanup_old_history_data(180);     -- 180 ‡∏ß‡∏±‡∏ô
```

#### 8. `cleanup_old_pending_devices()` - ‡∏•‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏£‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πà‡∏≤
```sql
-- ‡∏•‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏£‡∏≠‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ô‡∏≤‡∏ô
SELECT cleanup_old_pending_devices();     -- 30 ‡∏ß‡∏±‡∏ô (default)  
SELECT cleanup_old_pending_devices(7);    -- 7 ‡∏ß‡∏±‡∏ô
```

### üîê User Management Functions

#### 9. `update_user_last_login()` - ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏ß‡∏•‡∏≤ login ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
```sql
-- ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏ß‡∏•‡∏≤ login ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
SELECT update_user_last_login('user@example.com');
```

---

## üöÄ Triggers ‡πÅ‡∏•‡∏∞ Automation

### üìÖ Auto-Timestamp Triggers
```sql
-- ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó updated_at ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
CREATE TRIGGER trigger_users_updated_at 
BEFORE UPDATE ON users FOR EACH ROW 
EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER trigger_devices_prop_updated_at 
BEFORE UPDATE ON devices_prop FOR EACH ROW 
EXECUTE FUNCTION update_updated_at_column();
```

### üéØ Device Data Triggers
```sql
-- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• devices_data ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏´‡∏°‡πà
CREATE TRIGGER trigger_create_initial_device_data 
AFTER INSERT ON devices_prop FOR EACH ROW 
EXECUTE FUNCTION create_initial_device_data();

-- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á devices_history ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
CREATE TRIGGER trigger_archive_device_data 
AFTER UPDATE ON devices_data FOR EACH ROW 
EXECUTE FUNCTION archive_device_data();
```

### ‚è∞ MQTT Data Triggers
```sql
-- ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó last_seen_at ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• MQTT ‡πÉ‡∏´‡∏°‡πà
CREATE TRIGGER trigger_devices_pending_last_seen 
BEFORE UPDATE ON devices_pending FOR EACH ROW 
EXECUTE FUNCTION update_device_last_seen();
```

---

## üìä Indexes ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç

### üîç Performance Indexes
```sql
-- User Management
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_role ON users(role);
CREATE INDEX idx_users_active ON users(is_active) WHERE is_active = true;

-- Device Management  
CREATE INDEX idx_devices_prop_device_id ON devices_prop(device_id);
CREATE INDEX idx_devices_prop_status ON devices_prop(status, is_enabled);
CREATE INDEX idx_devices_data_device_id ON devices_data(device_id);
CREATE INDEX idx_devices_data_last_data_received ON devices_data(last_data_received DESC);

-- Location and Organization
CREATE INDEX idx_locations_faculty ON locations(faculty_id);
CREATE INDEX idx_locations_building ON locations(faculty_id, building);

-- Time-series Data
CREATE INDEX idx_devices_history_device_time ON devices_history(device_id, recorded_at DESC);
CREATE INDEX idx_devices_history_power ON devices_history(device_id, active_power, recorded_at DESC);

-- MQTT and Pending Devices
CREATE INDEX idx_devices_pending_discovered_at ON devices_pending(discovered_at DESC);
CREATE INDEX idx_devices_pending_last_seen ON devices_pending(last_seen_at DESC);
CREATE INDEX idx_devices_pending_mqtt_data_gin ON devices_pending USING gin(mqtt_data);
```

---

## üéõÔ∏è Enums ‡πÅ‡∏•‡∏∞ Custom Types

### üìù Device Status Enums
```sql
-- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
CREATE TYPE device_status_enum AS ENUM ('active', 'inactive', 'maintenance', 'error');

-- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢
CREATE TYPE network_status_enum AS ENUM ('online', 'offline', 'error');

-- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
CREATE TYPE connection_type_enum AS ENUM ('wifi', 'ethernet', 'cellular', 'lora', 'zigbee');

-- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå
CREATE TYPE meter_type_enum AS ENUM ('digital', 'analog');

-- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ü‡∏™‡πÑ‡∏ü‡∏ü‡πâ‡∏≤
CREATE TYPE power_phase_enum AS ENUM ('single', 'three');
```

---

## üîí Data Constraints ‡πÅ‡∏•‡∏∞ Validation

### ‚úÖ Business Rules Constraints
```sql
-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ö‡∏ß‡∏Å
ALTER TABLE devices_data ADD CONSTRAINT devices_data_voltage_check 
CHECK (voltage >= 0);

ALTER TABLE devices_data ADD CONSTRAINT devices_data_current_amperage_check 
CHECK (current_amperage >= 0);

ALTER TABLE devices_data ADD CONSTRAINT devices_data_active_power_check 
CHECK (active_power >= 0);

-- ‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á -1 ‡∏ñ‡∏∂‡∏á 1
ALTER TABLE devices_data ADD CONSTRAINT devices_data_power_factor_check 
CHECK (power_factor >= -1 AND power_factor <= 1);

-- ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° (40-70 Hz)
ALTER TABLE devices_data ADD CONSTRAINT devices_data_frequency_check 
CHECK (frequency >= 40 AND frequency <= 70);

-- ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏°‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏°‡∏ú‡∏• (-40¬∞C ‡∏ñ‡∏∂‡∏á 85¬∞C)
ALTER TABLE devices_data ADD CONSTRAINT devices_data_device_temperature_check 
CHECK (device_temperature >= -40 AND device_temperature <= 85);

-- ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ 0-100%
ALTER TABLE devices_data ADD CONSTRAINT devices_data_connection_quality_check 
CHECK (connection_quality >= 0 AND connection_quality <= 100);

-- ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì -120 ‡∏ñ‡∏∂‡∏á 0 dBm
ALTER TABLE devices_data ADD CONSTRAINT devices_data_signal_strength_check 
CHECK (signal_strength >= -120 AND signal_strength <= 0);
```

### üîß Unique Constraints
```sql
-- ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥
ALTER TABLE faculties ADD CONSTRAINT faculties_faculty_code_key UNIQUE (faculty_code);
ALTER TABLE manufacturers ADD CONSTRAINT manufacturers_name_key UNIQUE (name);
ALTER TABLE locations ADD CONSTRAINT unique_location UNIQUE (faculty_id, building, floor, room);
ALTER TABLE devices_prop ADD CONSTRAINT devices_prop_device_id_key UNIQUE (device_id);
ALTER TABLE devices_prop ADD CONSTRAINT devices_prop_meter_id_key UNIQUE (meter_id);
ALTER TABLE responsible_persons ADD CONSTRAINT responsible_persons_email_key UNIQUE (email);
```

---

## üéØ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á (Practical Usage)

### üìã Query Examples ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ

#### 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏Ñ‡∏ì‡∏∞‡πÉ‡∏î‡∏Ñ‡∏ì‡∏∞‡∏´‡∏ô‡∏∂‡πà‡∏á
```sql
SELECT dc.device_id, dc.device_name, dc.building, dc.room,
       dc.device_manufacturer, dc.meter_manufacturer,
       dc.active_power, dc.last_data_received
FROM devices_complete dc
WHERE dc.faculty_name = '‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå'
AND dc.is_enabled = true
ORDER BY dc.building, dc.room;
```

#### 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà offline ‡∏ô‡∏≤‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
```sql
SELECT device_id, device_name, faculty_name, building,
       last_data_received,
       AGE(NOW(), last_data_received) AS offline_duration
FROM devices_monitoring
WHERE data_stale = true
ORDER BY last_data_received ASC;
```

#### 3. ‡∏´‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î 10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö
```sql
SELECT device_id, device_name, faculty_name, building,
       active_power, device_temperature
FROM devices_dashboard
WHERE active_power IS NOT NULL
ORDER BY active_power DESC
LIMIT 10;
```

#### 4. ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ì‡∏∞
```sql
SELECT f.faculty_name,
       COUNT(dc.device_id) AS total_devices,
       AVG(dc.active_power) AS avg_power,
       SUM(dc.active_power) AS total_power,
       MAX(dc.active_power) AS max_power
FROM faculties f
LEFT JOIN locations l ON f.id = l.faculty_id
LEFT JOIN devices_prop dp ON l.id = dp.location_id
LEFT JOIN devices_data dd ON dp.device_id = dd.device_id
GROUP BY f.faculty_name
ORDER BY total_power DESC NULLS LAST;
```

#### 5. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤
```sql
SELECT device_id, device_name, faculty_name, building,
       device_temperature, last_data_received,
       CASE 
           WHEN device_temperature > 70 THEN 'High Temperature'
           WHEN last_data_received < NOW() - INTERVAL '1 hour' THEN 'Communication Lost'
           ELSE 'Check Required'
       END AS maintenance_reason
FROM devices_monitoring
WHERE temperature_high = true OR data_stale = true
ORDER BY device_temperature DESC;
```

---

## üìö ‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥

### ‚úÖ ‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á‡∏Ç‡∏≠‡∏á Schema Design

1. **üîÑ Normalized Design**: ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ï‡∏≤‡∏° Normal Forms ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô
2. **üîó Clear Relationships**: ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Foreign Keys
3. **üìä Comprehensive Views**: Views ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á
4. **‚ö° Optimized Indexes**: Indexes ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö query patterns ‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
5. **üõ°Ô∏è Data Integrity**: Constraints ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
6. **üîß Automation**: Triggers ‡πÅ‡∏•‡∏∞ Functions ‡∏•‡∏î‡∏á‡∏≤‡∏ô‡∏ã‡πâ‡∏≥‡πÜ
7. **üìà Scalable**: ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ç‡∏¢‡∏≤‡∏¢‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï

### üéØ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥

1. **Real-time Monitoring**: ‡πÉ‡∏ä‡πâ `devices_monitoring` view
2. **Dashboard Display**: ‡πÉ‡∏ä‡πâ `devices_dashboard` view  
3. **Device Management**: ‡πÉ‡∏ä‡πâ `devices_complete` view
4. **Approval Workflow**: ‡πÉ‡∏ä‡πâ Functions approve/reject
5. **Analytics**: ‡πÉ‡∏ä‡πâ `devices_history` table ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
6. **Maintenance**: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Cron Jobs ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å cleanup functions

### üîÆ ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡πà‡∏≠

1. **Partitioning**: ‡πÅ‡∏ö‡πà‡∏á `devices_history` ‡∏ï‡∏≤‡∏° timestamp
2. **Data Archiving**: ‡∏¢‡πâ‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡πÑ‡∏õ Archive database
3. **Performance Monitoring**: ‡πÄ‡∏û‡∏¥‡πà‡∏° monitoring ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö slow queries
4. **Backup Strategy**: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î backup schedule ‡πÅ‡∏•‡∏∞ retention policy

---

*‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö IoT Electric Energy Management*
